@inject HttpClient Http

<MudNavMenu>
    <MudNavLink Href="" Match="NavLinkMatch.All"
                Icon="@Icons.Material.Filled.Dashboard">
        Přehled
    </MudNavLink>
    <MudNavLink Href="listings"
                Icon="@Icons.Material.Filled.Apartment">
        Inzeráty
    </MudNavLink>
    <MudNavLink Href="map"
                Icon="@Icons.Material.Filled.Map">
        Mapa
    </MudNavLink>
    <MudNavLink Href="scrape"
                Icon="@Icons.Material.Filled.CloudSync">
        Scrapování
    </MudNavLink>
    <MudDivider Class="my-2" />
    <MudNavGroup Title="Zdroje dat" Icon="@Icons.Material.Filled.Source" Expanded="false">
        @if (_sources.Count == 0)
        {
            <MudNavLink Disabled="true" Icon="@Icons.Material.Outlined.HourglassEmpty">
                Načítám...
            </MudNavLink>
        }
        else
        {
            @foreach (var src in _sources)
            {
                <MudNavLink Href="@($"/listings?source={src.Code}")"
                            Icon="@Icons.Material.Outlined.FilterList">
                    @src.Name
                </MudNavLink>
            }
        }
    </MudNavGroup>
</MudNavMenu>

@code {
    private List<SourceNavDto> _sources = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var sources = await Http.GetFromJsonAsync<List<SourceNavDto>>("api/sources?onlyActive=true");
            _sources = sources ?? new();
        }
        catch
        {
            // Tiše selže – menu se zobrazí bez zdrojů
        }
    }

    private sealed record SourceNavDto(Guid Id, string Code, string Name, string BaseUrl, bool IsActive);
}

